<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ancient Greece QA Chatbot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- ‚úÖ Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ‚úÖ Custom CSS (optional dark/light mode, chat style) -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-mode"><!-- ‚úÖ Default mode is light -->

    <div class="container mt-5">
        <!-- ‚úÖ Header: Title + Toggle Dark Mode -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary">üß† Ancient Greece QA Bot</h1>
            <button class="btn btn-outline-secondary" onclick="toggleDarkMode()" id="toggle-btn">üåô Dark Mode</button>
        </div>

        <!-- ‚úÖ Input field and Ask button -->
        <div class="input-group mb-3">
            <input id="question" type="text" class="form-control" placeholder="Ask about Ancient Greece...">
            <button class="btn btn-primary" onclick="ask()">Ask</button>
        </div>

        <!-- ‚úÖ Response output -->
        <div id="response" class="response-container p-3 border rounded mb-3"></div>

        <!-- ‚úÖ Chat History section -->
        <h4 class="mt-4">üï∞Ô∏è Chat History</h4>
        <div id="chat-history" class="chat-history-container border p-3 rounded overflow-auto" style="max-height: 300px;"></div>
    </div>

    <!-- ‚úÖ Bootstrap JS bundle for components -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ‚úÖ Store chat history in memory
        const chatHistory = [];

        // ‚úÖ Function to ask a question and get an answer from backend
        async function ask() {
            const input = document.getElementById('question');
            const question = input.value.trim();
            if (!question) return; // ‚õî Don‚Äôt send empty questions

            // ‚úÖ Send the question to backend via POST
            const res = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question })
            });

            const data = await res.json(); // ‚úÖ Get the JSON response

            // ‚úÖ Display the answer and sources in main response area
            const responseEl = document.getElementById('response');
            const answerHTML = `
                <p><strong>Answer:</strong> ${data.answer}</p>
                <p><strong>Sources:</strong> ${data.sources.join(', ')}</p>
            `;
            responseEl.innerHTML = answerHTML;

            // ‚úÖ Add to chat history and render
            chatHistory.unshift({ question, answer: data.answer, sources: data.sources });
            const historyEl = document.getElementById('chat-history');
            historyEl.innerHTML = chatHistory.map(item => `
                <div class="mb-2">
                    <p><strong>Q:</strong> ${item.question}</p>
                    <p><strong>A:</strong> ${item.answer}</p>
                    <hr/>
                </div>
            `).join('');

            input.value = ''; // ‚úÖ Clear input
        }

        // ‚úÖ Toggle dark/light mode for the whole app
        function toggleDarkMode() {
            const body = document.body;
            const toggleBtn = document.getElementById('toggle-btn');

            const isDark = body.classList.contains('dark-mode');

            if (isDark) {
                // ‚úÖ Switch to light mode
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                toggleBtn.innerHTML = 'üåô Dark Mode';
            } else {
                // ‚úÖ Switch to dark mode
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                toggleBtn.innerHTML = '‚òÄÔ∏è Light Mode';
            }

            // (Optional) Debugging log
            console.log("Current body class:", body.className);
        }
    </script>
</body>
</html>
